# ğŸ¤– æ™ºèƒ½æ¨èç³»ç»Ÿæ–‡æ¡£

DoResearché¡¹ç›®çš„æ™ºèƒ½æ¨èç³»ç»Ÿï¼ŒåŸºäºç”¨æˆ·å®é™…è¡Œä¸ºï¼ˆè€Œéç®€å•çš„è¯»/æœªè¯»çŠ¶æ€ï¼‰è¿›è¡Œä¸ªæ€§åŒ–æ¨èã€‚

## ğŸ¯ ç³»ç»Ÿç‰¹ç‚¹

### è§£å†³çš„æ ¸å¿ƒé—®é¢˜
- **ä¼ ç»Ÿé—®é¢˜**ï¼šç”¨æˆ·ä¸ºäº†ç¡®è®¤æ–‡ç« å†…å®¹ä¼šç‚¹å¼€æŸ¥çœ‹ï¼Œå¯¼è‡´æ‰€æœ‰æ–‡ç« éƒ½è¢«æ ‡è®°ä¸º"å·²è¯»"ï¼Œæ— æ³•åŒºåˆ†çœŸæ­£çš„å…´è¶£
- **æˆ‘ä»¬çš„è§£å†³æ–¹æ¡ˆ**ï¼šåŸºäºå¤šç»´åº¦è¡Œä¸ºæ•°æ®ï¼ˆæµè§ˆæ—¶é•¿ã€æ»šåŠ¨æ·±åº¦ã€ç‚¹å‡»è¡Œä¸ºç­‰ï¼‰æ™ºèƒ½è¯„ä¼°ç”¨æˆ·å…´è¶£

### æ ¸å¿ƒä¼˜åŠ¿
- âœ… **æ™ºèƒ½å…´è¶£è¯„ä¼°**ï¼šåŒºåˆ†"éšä¾¿çœ‹çœ‹"å’Œ"çœŸæ­£æ„Ÿå…´è¶£"
- âœ… **å¤šç»´åº¦æ•°æ®**ï¼šæ—¶é—´ã€æ»šåŠ¨ã€ç‚¹å‡»ã€æ”¶è—ç­‰ç»¼åˆåˆ†æ
- âœ… **ä¸ªæ€§åŒ–æ¨è**ï¼šåŸºäºå®é™…è¡Œä¸ºæ¨¡å¼ï¼Œä¸æ˜¯ç®€å•çš„å…³é”®è¯åŒ¹é…
- âœ… **å®æ—¶å­¦ä¹ **ï¼šç”¨æˆ·è¡Œä¸ºè¶Šå¤šï¼Œæ¨èè¶Šç²¾å‡†
- âœ… **éšç§å‹å¥½**ï¼šæ‰€æœ‰æ•°æ®æœ¬åœ°å­˜å‚¨ï¼Œä¸ä¸Šä¼ ä¸ªäººä¿¡æ¯

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å‰ç«¯è¿½è¸ªåº“     â”‚â”€â”€â”€â–¶â”‚   äº¤äº’è¿½è¸ªæœåŠ¡    â”‚â”€â”€â”€â–¶â”‚   æ•°æ®åº“å­˜å‚¨     â”‚
â”‚ SmartTracker.js â”‚    â”‚InteractionTrackerâ”‚    â”‚ paper_interactionsâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ¨èAPIæ¥å£    â”‚â—€â”€â”€â”€â”‚  è¡Œä¸ºåˆ†æå¼•æ“     â”‚â—€â”€â”€â”€â”‚ å…´è¶£è¯„åˆ†è®¡ç®—     â”‚
â”‚   /api/rec/*    â”‚    â”‚BehaviorRecommenderâ”‚    â”‚paper_interest_scoresâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š æ•°æ®åº“è®¾è®¡

### 1. paper_interactions - äº¤äº’è®°å½•è¡¨
```sql
CREATE TABLE paper_interactions (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    paper_id INTEGER NOT NULL,
    interaction_type TEXT NOT NULL,  -- 'view_start', 'view_end', 'scroll', 'click_pdf' etc.
    duration_seconds INTEGER DEFAULT 0,
    scroll_depth_percent INTEGER DEFAULT 0,  -- 0-100
    click_count INTEGER DEFAULT 0,
    session_id TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 2. paper_interest_scores - å…´è¶£è¯„åˆ†è¡¨
```sql
CREATE TABLE paper_interest_scores (
    paper_id INTEGER PRIMARY KEY,
    interest_score INTEGER DEFAULT 0,     -- 0-100ç»¼åˆå…´è¶£åˆ†æ•°
    interaction_count INTEGER DEFAULT 0,  -- äº¤äº’æ¬¡æ•°
    total_view_time INTEGER DEFAULT 0,    -- æ€»æŸ¥çœ‹æ—¶é—´
    max_scroll_depth INTEGER DEFAULT 0,   -- æœ€å¤§æ»šåŠ¨æ·±åº¦
    explicit_interest INTEGER DEFAULT 0,  -- 1:å–œæ¬¢, -1:ä¸å–œæ¬¢, 0:ä¸­æ€§
    calculated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 3. user_interest_patterns - ç”¨æˆ·å…´è¶£æ¨¡å¼è¡¨
```sql
CREATE TABLE user_interest_patterns (
    pattern_type TEXT NOT NULL,      -- 'keyword', 'author', 'journal'
    pattern_value TEXT NOT NULL,     -- å…·ä½“çš„å…³é”®è¯/ä½œè€…/æœŸåˆŠå
    interest_strength REAL DEFAULT 0.0,  -- 0.0-1.0 å…´è¶£å¼ºåº¦
    occurrence_count INTEGER DEFAULT 0,   -- å‡ºç°æ¬¡æ•°
    UNIQUE(pattern_type, pattern_value)
);
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. æ•°æ®åº“è¿ç§»
```bash
# è¿è¡Œè¿ç§»è„šæœ¬æ·»åŠ æ¨èç³»ç»Ÿè¡¨
python scripts/migrate_recommendation_tables.py
```

### 2. å‰ç«¯é›†æˆ
```html
<!-- å¼•å…¥æ™ºèƒ½è¿½è¸ªåº“ -->
<script src="/static/js/smart-interaction-tracker.js"></script>

<script>
// åˆå§‹åŒ–è¿½è¸ªå™¨
const tracker = new SmartInteractionTracker({
    debug: true,  // å¼€å‘æ¨¡å¼
    trackScrolling: true,
    trackClicks: true
});

// åœ¨è®ºæ–‡è¯¦æƒ…é¡µå¼€å§‹è¿½è¸ª
tracker.startTrackingPaper(paperId, paperTitle);

// ç”¨æˆ·æ˜ç¡®è¡¨ç¤ºå…´è¶£æ—¶
document.getElementById('like-btn').onclick = () => {
    tracker.markInterest(paperId, 'like');
};

// è·å–ä¸ªæ€§åŒ–æ¨è
async function loadRecommendations() {
    const result = await tracker.getPersonalizedRecommendations(10);
    if (result.success) {
        displayRecommendations(result.data.recommendations);
    }
}
</script>
```

### 3. åç«¯APIä½¿ç”¨
```python
from services.interaction_tracker import InteractionTracker
from services.behavior_based_recommender import BehaviorBasedRecommender

# åˆå§‹åŒ–æœåŠ¡
tracker = InteractionTracker()
recommender = BehaviorBasedRecommender()

# è®°å½•ç”¨æˆ·äº¤äº’
tracker.track_paper_view(paper_id=123, duration_seconds=180, scroll_depth_percent=85)

# è·å–ä¸ªæ€§åŒ–æ¨è
recommendations = recommender.get_personalized_recommendations(limit=10)

# æŸ¥æ‰¾ç›¸ä¼¼è®ºæ–‡
similar_papers = recommender.find_similar_papers(paper_id=123, limit=5)
```

## ğŸ“¡ APIæ¥å£è¯¦æƒ…

### äº¤äº’è¿½è¸ªæ¥å£

#### POST /api/interactions/track
è®°å½•ç”¨æˆ·äº¤äº’è¡Œä¸º
```json
{
    "paper_id": 123,
    "interaction_type": "view_end",
    "duration_seconds": 120,
    "scroll_depth_percent": 75,
    "session_id": "session_xxx"
}
```

#### POST /api/interactions/track-view
è®°å½•è®ºæ–‡æŸ¥çœ‹ï¼ˆå¸¦æ™ºèƒ½åˆ†æï¼‰
```json
{
    "paper_id": 123,
    "duration_seconds": 180,
    "scroll_depth_percent": 85,
    "session_id": "session_xxx"
}
```

å“åº”ç¤ºä¾‹ï¼š
```json
{
    "success": true,
    "data": {
        "paper_id": 123,
        "interest_level": "high",
        "interest_score": 78,
        "signals": ["æ·±åº¦é˜…è¯» (2-5åˆ†é’Ÿ)", "è¯¦ç»†æŸ¥çœ‹å†…å®¹"]
    }
}
```

### æ¨èç³»ç»Ÿæ¥å£

#### GET /api/recommendations/personalized
è·å–ä¸ªæ€§åŒ–æ¨è
```json
{
    "success": true,
    "data": {
        "recommendations": [
            {
                "id": 456,
                "title": "Recommended Paper Title",
                "recommendation_score": 0.85,
                "matched_features": ["å…³é”®è¯: machine learning", "ä½œè€…: John Smith"],
                "keyword_matches": 3,
                "author_matches": 1
            }
        ],
        "count": 10
    }
}
```

#### GET /api/recommendations/similar/{paper_id}
è·å–ç›¸ä¼¼è®ºæ–‡æ¨è
```json
{
    "success": true,
    "data": {
        "target_paper_id": 123,
        "similar_papers": [
            {
                "id": 789,
                "title": "Similar Paper Title",
                "similarity_score": 0.72,
                "keyword_matches": 5
            }
        ]
    }
}
```

#### POST /api/interactions/mark-interest
æ˜ç¡®æ ‡è®°å…´è¶£
```json
{
    "paper_id": 123,
    "interest_type": "like"  // 'like' or 'dislike'
}
```

## ğŸ§  æ™ºèƒ½ç®—æ³•è¯¦è§£

### 1. å…´è¶£è¯„åˆ†ç®—æ³•
```python
def calculate_interest_score(interactions):
    score = 0
    
    # åŸºäºæµè§ˆæ—¶é—´ (30% æƒé‡)
    if duration < 10:      score -= 5   # å¿«é€Ÿè·³è¿‡
    elif duration < 30:    score += 5   # ç®€å•æµè§ˆ
    elif duration < 120:   score += 15  # ä¸­ç­‰å…³æ³¨
    elif duration < 300:   score += 25  # æ·±åº¦é˜…è¯»
    else:                  score += 35  # é•¿æ—¶é—´ç ”ç©¶
    
    # åŸºäºæ»šåŠ¨æ·±åº¦ (20% æƒé‡)
    if scroll_depth < 20:  score -= 2   # ä»…çœ‹æ ‡é¢˜
    elif scroll_depth < 50: score += 5  # æµè§ˆæ‘˜è¦
    elif scroll_depth < 80: score += 12 # è¯¦ç»†æŸ¥çœ‹
    else:                   score += 18 # å®Œæ•´æµè§ˆ
    
    # åŸºäºè¡Œä¸ºæƒé‡ (50% æƒé‡)
    action_weights = {
        'bookmark': +20,      # æ”¶è—
        'click_pdf': +15,     # ç‚¹å‡»PDF
        'explicit_like': +25, # æ˜ç¡®å–œæ¬¢
        'explicit_dislike': -25  # æ˜ç¡®ä¸å–œæ¬¢
    }
    
    return max(0, min(100, score))
```

### 2. ä¸ªæ€§åŒ–æ¨èç®—æ³•
```python
def get_personalized_recommendations():
    # 1. åˆ†æç”¨æˆ·å…´è¶£æ¨¡å¼
    user_patterns = analyze_user_patterns()
    
    # 2. ç­›é€‰å€™é€‰è®ºæ–‡ï¼ˆåªé€‰æ‹©æœªè¯»çš„ï¼‰
    candidates = get_unread_papers()
    
    # 3. æå–ç‰¹å¾æƒé‡
    keywords = user_patterns['keywords']    # 70%æƒé‡
    authors = user_patterns['authors']      # 20%æƒé‡  
    journals = user_patterns['journals']    # 10%æƒé‡
    
    # 4. è®¡ç®—å€™é€‰è®ºæ–‡åŒ¹é…åˆ†æ•°
    for candidate in candidates:
        score = 0
        score += keyword_match_score * 0.7
        score += author_match_score * 0.2
        score += journal_match_score * 0.1
        
        # 5. æ–°é²œåº¦åŠ æˆï¼ˆè¶Šæ–°çš„æ–‡ç« æƒé‡è¶Šé«˜ï¼‰
        freshness_bonus = calculate_freshness_bonus(candidate.date)
        score += freshness_bonus  # æœ€é«˜+0.3åˆ†
        
    # 6. è¿‡æ»¤å·²äº¤äº’è®ºæ–‡ï¼Œè¿”å›Top-N
    return filter_and_rank(scored_candidates)
```

## ğŸ“ˆ æ€§èƒ½ç›‘æ§

### ç»Ÿè®¡æ¥å£
- `GET /api/interactions/stats` - äº¤äº’ç»Ÿè®¡
- `GET /api/interactions/user-patterns` - å…´è¶£æ¨¡å¼åˆ†æ
- `GET /api/recommendations/dashboard` - æ¨èç³»ç»Ÿä»ªè¡¨æ¿

### æ€§èƒ½æŒ‡æ ‡
- **æ•°æ®æ”¶é›†ç‡**ï¼šç”¨æˆ·äº¤äº’è®°å½•æˆåŠŸç‡
- **æ¨èå‡†ç¡®ç‡**ï¼šç”¨æˆ·å¯¹æ¨èå†…å®¹çš„å®é™…å…´è¶£åº¦
- **ç³»ç»Ÿå“åº”æ—¶é—´**ï¼šæ¨èç®—æ³•æ‰§è¡Œé€Ÿåº¦
- **ç”¨æˆ·å‚ä¸åº¦**ï¼šæ˜ç¡®æ ‡è®°å…´è¶£çš„æ¯”ä¾‹

## ğŸ”§ é…ç½®é€‰é¡¹

### InteractionTrackeré…ç½®
```python
# services/interaction_tracker.py
INTEREST_WEIGHTS = {
    'VIEW_START': 1,
    'SCROLL': 2,
    'CLICK_PDF': 10,
    'BOOKMARK': 15,
    'EXPLICIT_LIKE': 20,
    'EXPLICIT_DISLIKE': -20,
}
```

### æ¨èç®—æ³•é…ç½®
```python
# services/behavior_based_recommender.py
MIN_INTEREST_SCORE = 50      # æœ€ä½å…´è¶£é˜ˆå€¼
SIMILARITY_THRESHOLD = 0.3   # ç›¸ä¼¼åº¦é˜ˆå€¼
MAX_RECOMMENDATIONS = 20     # æœ€å¤§æ¨èæ•°é‡
```

### å‰ç«¯è¿½è¸ªé…ç½®
```javascript
const tracker = new SmartInteractionTracker({
    apiBase: '/api',           // APIåŸºç¡€è·¯å¾„
    debounceDelay: 1000,      // é˜²æŠ–å»¶è¿Ÿ
    trackScrolling: true,      // æ˜¯å¦è¿½è¸ªæ»šåŠ¨
    trackClicks: true,         // æ˜¯å¦è¿½è¸ªç‚¹å‡»
    debug: false              // è°ƒè¯•æ¨¡å¼
});
```

## ğŸš¨ æ³¨æ„äº‹é¡¹

### æ•°æ®éšç§
- æ‰€æœ‰äº¤äº’æ•°æ®æœ¬åœ°å­˜å‚¨ï¼Œä¸ä¸Šä¼ åˆ°å¤–éƒ¨æœåŠ¡
- ä¸æ”¶é›†ç”¨æˆ·ä¸ªäººèº«ä»½ä¿¡æ¯
- æ”¯æŒæ•°æ®æ¸…ç†å’Œé‡ç½®åŠŸèƒ½

### æ€§èƒ½è€ƒè™‘
- äº¤äº’æ•°æ®å¼‚æ­¥è®°å½•ï¼Œä¸å½±å“ç”¨æˆ·ä½“éªŒ
- æ¨èè®¡ç®—é‡‡ç”¨ç¼“å­˜æœºåˆ¶
- æ•°æ®åº“æŸ¥è¯¢å·²ä¼˜åŒ–ç´¢å¼•

### å…¼å®¹æ€§
- æ”¯æŒç°ä»£æµè§ˆå™¨ï¼ˆES6+ï¼‰
- æ¸è¿›å¼å¢å¼ºï¼Œä¸å½±å“åŸºç¡€åŠŸèƒ½
- æœåŠ¡ç«¯å®¹é”™å¤„ç†ï¼ŒAPIè°ƒç”¨å¤±è´¥ä¸å½±å“ä¸»æµç¨‹

## ğŸ”® æœªæ¥è§„åˆ’

- [ ] **æ·±åº¦å­¦ä¹ æ¨è**ï¼šé›†æˆæ›´å…ˆè¿›çš„æœºå™¨å­¦ä¹ ç®—æ³•
- [ ] **ååŒè¿‡æ»¤**ï¼šåŸºäºç›¸ä¼¼ç”¨æˆ·çš„æ¨è
- [ ] **å¤šæ¨¡æ€åˆ†æ**ï¼šç»“åˆå›¾åƒã€æ–‡æœ¬ç­‰å¤šç§ç‰¹å¾
- [ ] **å®æ—¶æ¨è**ï¼šåŸºäºå½“å‰æµè§ˆä¸Šä¸‹æ–‡çš„å³æ—¶æ¨è
- [ ] **A/Bæµ‹è¯•æ¡†æ¶**ï¼šæ¨èç®—æ³•æ•ˆæœå¯¹æ¯”æµ‹è¯•

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š
- åœ¨é¡¹ç›®Issueä¸­æå‡ºé—®é¢˜
- æŸ¥çœ‹ä»£ç æ³¨é‡Šäº†è§£è¯¦ç»†å®ç°
- å‚è€ƒæµ‹è¯•ç”¨ä¾‹äº†è§£ä½¿ç”¨æ–¹æ³•

---

*æ™ºèƒ½æ¨èç³»ç»Ÿè®©è®ºæ–‡å‘ç°æ›´åŠ ç²¾å‡†é«˜æ•ˆï¼ğŸ¯*